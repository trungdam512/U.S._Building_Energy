---
title: "Building Energy Spatial Viz"
format: html
editor: visual
---

```{r, echo=FALSE}
library(tidyverse)
library(sf) # tools for working with spatial vector data (GIS functionality, mapping)
library(terra)
library(tidycensus) # spatial data for the US with census information
library(USAboundaries) # access to boundaries for US states, counties, zip codes, and congressional districts
library(tigris)
library(tidyverse)
library(purrr)
```

```{r echo=FALSE}
acs2015 <- tidycensus::get_acs(
    year = 2015,
    geography = "state",
    variables = c("B19013_001", "B25003_001", "B25058_001",  "B25003_001", "B25003_002", "B25003_003", "B25077_001", "B25105_001", "B25035_001", "B25024_001", "B25024_002", "B25024_003", "B25024_004", "B25024_005", "B25024_006", "B25024_007", "B25024_008", "B25024_009", "B25024_010"),
    output = "wide",
    geometry = TRUE
) %>%
    rename(
        "medianIncome" = "B19013_001E",
        "medContractRent" = "B25058_001E",
        "tenureTotal" = "B25003_001E",
        "tenureOwned" = "B25003_002E",
        "tenureRented" = "B25003_003E",
        "medianHomeValue"= "B25077_001E",
        "monthHousingCosts" = "B25105_001E",
        "med_year_built" = "B25035_001E",
        "total_units"= "B25024_001E",
        "unit_1_detached" = "B25024_002E",
        "unit_1_attached" = "B25024_003E",
        "unit_2" = "B25024_004E",
        "unit_3_4" = "B25024_005E",
        "unit_5_9" = "B25024_006E",
        "unit_10_19" = "B25024_007E",
        "unit_20_49" ="B25024_008E",
        "unit_50_plus" = "B25024_009E",
        "mobile_home" = "B25024_010E") %>% 
  shift_geometry()

acs2015_agg <- acs2015 %>% 
  mutate(units_2_4 = unit_2 + unit_3_4,
         units_5_plus = unit_5_9 + unit_10_19 + unit_20_49 + unit_50_plus) %>% 
  filter(NAME != "Puerto Rico")
  
```

```{r}
# ggplot() +
#   geom_sf(data = acs2015, aes(fill = medContractRent)) +  
#   scale_fill_distiller(palette = "Greens", 
#                        direction = 1) + 
#   labs(title = "Median Rent by State (Utilities Not Included), 2011-2015",
#        caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
#        fill = "ACS estimate") + 
#     ggthemes::theme_map()
# 
# ggplot() +
#   geom_sf(data = acs2015, aes(fill = medianHomeValue)) +
#   scale_fill_distiller(palette = "Greens", 
#                        direction = 1) + 
#   labs(title = "Median Home Value by State, 2011-2015",
#        caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
#        fill = "ACS estimate") + 
#     ggthemes::theme_map()
# 
# 
# ggplot() +
#   geom_sf(data = acs2015, aes(fill = med_year_built)) +
#     scale_fill_distiller(palette = "Greens", 
#                        direction = 1) + 
#   labs(title = "Median Year House Was Built by State, 2011-2015",
#        caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
#        fill = "ACS estimate") + 
#     ggthemes::theme_map()




ggplot() +
  geom_sf(data = acs2015_agg, aes(fill = unit_1_attached/total_units)) +
      scale_fill_distiller(palette = "Purples", 
                       direction = 1) + 
  labs(title = "Proportion of Single Unit Attached Homes, 2011-2015",
       caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
       fill = "ACS estimate") + 
    ggthemes::theme_map()

ggplot() +
  geom_sf(data = acs2015_agg, aes(fill = unit_1_detached/total_units)) +
      scale_fill_distiller(palette = "Purples", 
                       direction = 1) + 
  labs(title = "Proportion of Single Unit Attached Homes, 2011-2015",
       caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
       fill = "ACS estimate") + 
    ggthemes::theme_map()


ggplot() +
  geom_sf(data = acs2015_agg, aes(fill = units_2_4/total_units)) +
        scale_fill_distiller(palette = "Purples", 
                       direction = 1) + 
  labs(title = "Proportion of 2-4 Unit Homes, 2011-2015",
       caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
       fill = "ACS estimate") + 
    ggthemes::theme_map()


ggplot() +
  geom_sf(data = acs2015_agg, aes(fill = units_5_plus/total_units)) +
        scale_fill_distiller(palette = "Purples", 
                       direction = 1) + 
  labs(title = "Proportion of 5+ Unit Homes, 2011-2015",
       caption = "Data source: 2011-2015 5-year ACS, US Census Bureau",
       fill = "ACS estimate") + 
    ggthemes::theme_map()
```


```{r}
recs <- readRDS("../data/recs_2015_cleaned.RDS")
```


```{r}
recs_agg <- recs %>% 
  count(region_name, housing_type) 


# recs_spatial <- acs2015_agg %>% 
#   mutate(NAME = map_chr(NAME, str_split_i, pattern = " ", i = 1)) %>% 
#   select(NAME, geometry) %>% 
#   left_join(recs_agg, join_by(NAME == region_name))
```


